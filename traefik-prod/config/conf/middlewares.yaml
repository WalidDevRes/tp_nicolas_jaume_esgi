http:
  middlewares:

    # Middleware Authentik (authentification)
    authentik:
      forwardAuth:
        address: http://authentik-server-prod-1:9000/outpost.goauthentik.io/auth/traefik
        trustForwardHeader: true
        authResponseHeaders:
          - X-authentik-username
          - X-authentik-groups
          - X-authentik-entitlements
          - X-authentik-email
          - X-authentik-name
          - X-authentik-uid
          - X-authentik-jwt
          - X-authentik-meta-jwks
          - X-authentik-meta-outpost
          - X-authentik-meta-provider
          - X-authentik-meta-app
          - X-authentik-meta-version

    # Middleware CrowdSec (sécurité)
    crowdsec:
      plugin:
        bouncer:
          enabled: true
          defaultDecisionSeconds: 60
          remediationStatusCode: 403
          crowdsecMode: live
          crowdsecLapiKey: api_key_crownsec
          crowdsecLapiHost: crowdsec:8080
          crowdsecLapiScheme: http
          crowdsecLapiTLSInsecureVerify: false
          forwardedHeadersTrustedIPs:
            - 10.10.10.0/30
            - 172.16.0.0/16
            - 192.168.1.0/24
            - 90.118.7.168/16
          clientTrustedIPs:
            - 172.16.0.0/12
            - 192.168.0.0/16

    # Middleware CORS ONLYOFFICE
    onlyoffice-headers:
      headers:
        accessControlAllowMethods:
          - GET
          - POST
          - OPTIONS
          - PUT
          - DELETE
        accessControlAllowOriginList:
          - https://nextcloud.mydomain.uk
        accessControlAllowHeaders:
          - Content-Type
          - Authorization
          - X-Requested-With
          - Accept
          - Origin
        accessControlMaxAge: 100
        addVaryHeader: true
        customRequestHeaders:
          X-Forwarded-Proto: https
